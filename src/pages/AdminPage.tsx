import React, { useEffect, useState } from 'react'
export default function AdminPage(){ const [s,setS]=useState(''); const [auth,setAuth]=useState(false); const [events,setEvents]=useState<any[]>([]); const [counters,setCounters]=useState<any[]>([]);
const test = async ()=>{ try{ const r=await fetch('/api/admin-auth',{headers:{'x-admin-secret':s}}); const j=await r.json(); if(j.ok) setAuth(true); else alert('unauth') }catch(e){alert('err')} }
useEffect(()=>{ if(auth) (async ()=>{ const r=await fetch('/api/admin-analytics',{headers:{'x-admin-secret':s}}); const j=await r.json(); setEvents(j.events||[]); setCounters(j.counters||[]) })() },[auth])
if(!auth) return (<div className="max-w-xl mx-auto p-8"><h2 className="text-2xl font-semibold mb-4">Admin Panel (hidden)</h2><input value={s} onChange={(e:any)=>setS(e.target.value)} placeholder="Enter admin secret" className="w-full border p-2 rounded mb-3"/><button onClick={test} className="px-4 py-2 bg-black text-white rounded">Enter</button></div>)
return (<div className="p-6"><h1 className="text-2xl font-semibold">Analytics</h1><section className="mt-4"><h3 className="text-lg font-medium">Counters</h3><ul>{counters.map((c:any)=><li key={c.id}>{c.key}: {c.value}</li>)}</ul></section><section className="mt-4"><h3 className="text-lg font-medium">Events</h3><div className="overflow-auto max-h-96"><table className="w-full text-sm"><thead><tr><th>time</th><th>event</th><th>owner</th><th>meta</th></tr></thead><tbody>{events.map(ev=>(<tr key={ev.id}><td>{new Date(ev.created_at).toLocaleString()}</td><td>{ev.event_type}</td><td>{ev.owner||'anon'}</td><td><pre className="text-xs">{JSON.stringify(ev.metadata)}</pre></td></tr>))}</tbody></table></div></section></div>)
}
